<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire Catégories et Produits</title>
    <style>
        .category {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<h1>Ajouter des Catégories et Produits</h1>
<form id="categoryForm" method="POST" action="/categories">
    <input type="hidden" name="bddname" th:value="${bddname}" />
    <div id="categories">
        <div class="category" data-category-id="1">
            <label for="categoryName_1">Nom de la catégorie:</label>
            <input type="text" id="categoryName_1" name="categories[1].name" required>
            <button type="button" onclick="addProductField(1)">Ajouter un produit</button>
            <div id="products_1"></div>
        </div>
    </div>
    <button type="button" onclick="addCategoryField()">Ajouter une catégorie</button>
    <button type="submit">Envoyer</button>
</form>

<script>
    let categoryIdCounter = 2;
    let productIdCounter = 1;

    function addCategoryField() {
        const categoriesDiv = document.getElementById('categories');

        const newCategoryDiv = document.createElement('div');
        newCategoryDiv.classList.add('category');
        newCategoryDiv.setAttribute('data-category-id', categoryIdCounter);

        newCategoryDiv.innerHTML = `
                <label for="categoryName_${categoryIdCounter}">Nom de la catégorie:</label>
                <input type="text" id="categoryName_${categoryIdCounter}" name="categories[${categoryIdCounter}].name" required>
                <button type="button" onclick="addProductField(${categoryIdCounter})">Ajouter un produit</button>
                <div id="products_${categoryIdCounter}"></div>
            `;

        categoriesDiv.appendChild(newCategoryDiv);
        categoryIdCounter++;
    }

    function addProductField(categoryId) {
        const productsDiv = document.getElementById(`products_${categoryId}`);

        const newProductDiv = document.createElement('div');
        newProductDiv.classList.add('product');
        newProductDiv.setAttribute('data-product-id', productIdCounter);

        newProductDiv.innerHTML = `
                <label for="productName_${productIdCounter}">Nom du produit:</label>
                <input type="text" id="productName_${productIdCounter}" name="categories[${categoryId}].products[${productIdCounter}].name" required>
                <input type="hidden" name="categories[${categoryId}].products[${productIdCounter}].categoryId" value="${categoryId}">
            `;

        productsDiv.appendChild(newProductDiv);
        productIdCounter++;
    }
</script>
</body>
</html>



<!--<!DOCTYPE html>-->
<!--<html lang="fr">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Ajouter des catégories</title>-->
<!--    <style>-->
<!--        .category {-->
<!--            margin-bottom: 20px;-->
<!--        }-->
<!--        .products {-->
<!--            margin-left: 20px;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<h1>Ajouter des catégories</h1>-->
<!--<form id="dynamicForm" method="POST" action="categories">-->
<!--    <div id="categories">-->
<!--        &lt;!&ndash; Les catégories seront ajoutées ici &ndash;&gt;-->
<!--    </div>-->
<!--    <button type="button" onclick="addCategory()">Ajouter une catégorie</button>-->
<!--    <button type="submit">Envoyer</button>-->
<!--</form>-->

<!--<script>-->
<!--    let categoryIdCounter = 0;-->
<!--    let productIdCounter = 0;-->

<!--    function addCategory() {-->
<!--        const categoriesDiv = document.getElementById('categories');-->
<!--        const categoryDiv = document.createElement('div');-->
<!--        categoryDiv.className = 'category';-->

<!--        const categoryId = `category_${categoryIdCounter++}`;-->
<!--        const categoryLabel = document.createElement('label');-->
<!--        categoryLabel.textContent = 'Nom de la catégorie: ';-->
<!--        const categoryInput = document.createElement('input');-->
<!--        categoryInput.type = 'text';-->
<!--        categoryInput.name = `categoryName_${categoryId}`;-->
<!--        categoryInput.id = categoryId;-->

<!--        const productsDiv = document.createElement('div');-->
<!--        productsDiv.className = 'products';-->
<!--        productsDiv.dataset.categoryId = categoryId;-->

<!--        const addProductButton = document.createElement('button');-->
<!--        addProductButton.type = 'button';-->
<!--        addProductButton.textContent = '+';-->
<!--        addProductButton.onclick = function() {-->
<!--            addProduct(productsDiv);-->
<!--        };-->

<!--        categoryDiv.appendChild(categoryLabel);-->
<!--        categoryDiv.appendChild(categoryInput);-->
<!--        categoryDiv.appendChild(addProductButton);-->
<!--        categoryDiv.appendChild(productsDiv);-->

<!--        categoriesDiv.appendChild(categoryDiv);-->
<!--    }-->

<!--    function addProduct(productsDiv) {-->
<!--        const productDiv = document.createElement('div');-->

<!--        const productId = `product_${productIdCounter++}`;-->
<!--        const productLabel = document.createElement('label');-->
<!--        productLabel.textContent = 'Nom du produit: ';-->
<!--        const productInput = document.createElement('input');-->
<!--        productInput.type = 'text';-->
<!--        productInput.name = `productName_${productId}`;-->
<!--        productInput.id = productId;-->
<!--        productInput.dataset.categoryId = productsDiv.dataset.categoryId;-->

<!--        productDiv.appendChild(productLabel);-->
<!--        productDiv.appendChild(productInput);-->

<!--        productsDiv.appendChild(productDiv);-->
<!--    }-->
<!--</script>-->
<!--</body>-->
<!--</html>-->